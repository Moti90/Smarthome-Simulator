<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="utf-8">
  <title>Auth0 Test - Smart Home Simulator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .status {
      padding: 15px;
      border-radius: 6px;
      margin: 15px 0;
    }
    .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #0056b3; }
    .user-info {
      background: #e9ecef;
      padding: 15px;
      border-radius: 6px;
      margin: 15px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîê Auth0 Integration Test</h1>
    <p>Denne side tester Auth0 integrationen f√∏r deployment til GitHub.</p>
    
    <div id="status-container">
      <div class="status info">Initialiserer Auth0...</div>
    </div>
    
    <div id="auth-ui" style="display: none;">
      <h3>Authentication</h3>
      <button id="btnLogin">Login</button>
      <button id="btnLogout" style="display: none;">Logout</button>
    </div>
    
    <div id="user-info" class="user-info" style="display: none;">
      <h3>User Information</h3>
      <div id="user-details"></div>
    </div>
    
    <div id="test-results">
      <h3>Test Results</h3>
      <div id="results-list"></div>
    </div>
  </div>

  <!-- Auth0 SDK -->
  <script src="https://cdn.auth0.com/js/auth0-spa-js/2.1/auth0-spa-js.production.js"></script>
  
  <!-- Auth0 Configuration and Services -->
  <script src="auth0-config.js"></script>
  <script src="auth0-service.js"></script>
  
  <script>
    const statusContainer = document.getElementById('status-container');
    const authUI = document.getElementById('auth-ui');
    const userInfo = document.getElementById('user-info');
    const userDetails = document.getElementById('user-details');
    const btnLogin = document.getElementById('btnLogin');
    const btnLogout = document.getElementById('btnLogout');
    const resultsList = document.getElementById('results-list');
    
    let testResults = [];
    
    function addStatus(message, type = 'info') {
      const status = document.createElement('div');
      status.className = `status ${type}`;
      status.textContent = message;
      statusContainer.appendChild(status);
    }
    
    function addTestResult(test, passed, details = '') {
      const result = { test, passed, details };
      testResults.push(result);
      
      const resultItem = document.createElement('div');
      resultItem.className = `status ${passed ? 'success' : 'error'}`;
      resultItem.innerHTML = `
        <strong>${test}:</strong> ${passed ? '‚úÖ PASSED' : '‚ùå FAILED'}
        ${details ? `<br><small>${details}</small>` : ''}
      `;
      resultsList.appendChild(resultItem);
    }
    
    async function runTests() {
      addStatus('üß™ Running Auth0 integration tests...', 'info');
      
      // Test 1: Auth0 SDK loaded
      try {
        if (typeof auth0 !== 'undefined') {
          addTestResult('Auth0 SDK Loaded', true);
        } else {
          addTestResult('Auth0 SDK Loaded', false, 'auth0 object not found');
        }
      } catch (error) {
        addTestResult('Auth0 SDK Loaded', false, error.message);
      }
      
      // Test 2: Auth0Config loaded
      try {
        if (typeof Auth0Config !== 'undefined') {
          addTestResult('Auth0Config Loaded', true);
        } else {
          addTestResult('Auth0Config Loaded', false, 'Auth0Config object not found');
        }
      } catch (error) {
        addTestResult('Auth0Config Loaded', false, error.message);
      }
      
      // Test 3: Auth0Service loaded
      try {
        if (typeof Auth0Service !== 'undefined') {
          addTestResult('Auth0Service Loaded', true);
        } else {
          addTestResult('Auth0Service Loaded', false, 'Auth0Service object not found');
        }
      } catch (error) {
        addTestResult('Auth0Service Loaded', false, error.message);
      }
      
      // Test 4: Auth0 initialization
      try {
        if (Auth0Config && Auth0Config.isAuth0Ready) {
          addTestResult('Auth0 Initialization', true);
        } else {
          addTestResult('Auth0 Initialization', false, 'Auth0Config.isAuth0Ready not found');
        }
      } catch (error) {
        addTestResult('Auth0 Initialization', false, error.message);
      }
      
      addStatus('‚úÖ Tests completed!', 'success');
    }
    
    function setupAuthUI() {
      if (!btnLogin || !btnLogout) return;
      
      btnLogin.addEventListener('click', async () => {
        try {
          addStatus('üîê Login initiated...', 'info');
          await Auth0Service.login();
        } catch (error) {
          addStatus(`‚ùå Login error: ${error.message}`, 'error');
        }
      });
      
      btnLogout.addEventListener('click', async () => {
        try {
          addStatus('üö™ Logout initiated...', 'info');
          await Auth0Service.logout();
        } catch (error) {
          addStatus(`‚ùå Logout error: ${error.message}`, 'error');
        }
      });
      
      // Listen for auth state changes
      Auth0Service.onAuthStateChanged((isAuthenticated, user) => {
        if (isAuthenticated && user) {
          btnLogin.style.display = 'none';
          btnLogout.style.display = 'inline-block';
          userInfo.style.display = 'block';
          
          userDetails.innerHTML = `
            <p><strong>Name:</strong> ${user.name || user.nickname || 'N/A'}</p>
            <p><strong>Email:</strong> ${user.email || 'N/A'}</p>
            <p><strong>User ID:</strong> ${user.sub || 'N/A'}</p>
          `;
          
          addStatus('‚úÖ User authenticated successfully!', 'success');
        } else {
          btnLogin.style.display = 'inline-block';
          btnLogout.style.display = 'none';
          userInfo.style.display = 'none';
          userDetails.innerHTML = '';
          
          addStatus('‚ÑπÔ∏è User not authenticated', 'info');
        }
      });
    }
    
    // Wait for everything to load
    document.addEventListener('DOMContentLoaded', async () => {
      addStatus('üöÄ DOM loaded, waiting for Auth0...', 'info');
      
      // Wait for Auth0 to be ready
      let attempts = 0;
      const maxAttempts = 100; // 10 seconds (increased from 5 seconds)
      
      const waitForAuth0 = setInterval(() => {
        attempts++;
        
        if (Auth0Service && Auth0Service.isInitialized) {
          clearInterval(waitForAuth0);
          addStatus('‚úÖ Auth0 ready!', 'success');
          
          authUI.style.display = 'block';
          setupAuthUI();
          runTests();
        } else if (attempts >= maxAttempts) {
          clearInterval(waitForAuth0);
          addStatus('‚ùå Auth0 failed to initialize after 10 seconds', 'error');
          runTests();
        } else {
          addStatus(`‚è≥ Waiting for Auth0... (${attempts}/${maxAttempts})`, 'info');
        }
      }, 100);
    });
  </script>
</body>
</html>
